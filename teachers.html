<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teacher Portal - Subjects & Grades</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th input.subject-name {
      width: 90%;
      font-weight: bold;
      font-size: 0.9rem;
      padding: 2px 4px;
    }
    input.grade-input {
      width: 60px;
    }
    button {
      margin: 10px 5px;
      padding: 8px 12px;
      cursor: pointer;
    }
    #logout {
      float: right;
      background-color: crimson;
      color: white;
    }
    .avg {
      font-weight: bold;
    }
    .blue {
      color: blue;
    }
    .red {
      color: red;
    }
    input:disabled {
      background-color: #ddd;
    }
  </style>
</head>
<body>
  <h2>Welcome, Teacher</h2>
  <button onclick="addSubject()">âž• Add Subject</button>
  <button onclick="addStudent()">âž• Add Student</button>
  <button onclick="saveDraft()">ðŸ’¾ Save as Draft</button>
  <button onclick="submitGrades()">ðŸ“¤ Submit Grades</button>
  <button id="logout" onclick="confirmLogout()">ðŸšª Logout</button>

  <table id="gradeTable">
    <tr>
      <th>Student Name</th>
      <!-- Subject name header inputs will go here -->
      <th>Average</th>
      <th>Rank</th>
    </tr>
    <tr>
      <td><input placeholder="Student 1"></td>
      <!-- Grade inputs will go here -->
      <td class="avg">-</td>
      <td class="rank">-</td>
    </tr>
  </table>

  <script>
    let studentCount = 1;
    let subjectCount = 0;
    let gradesSubmitted = false;

    function addSubject() {
      if (gradesSubmitted) return alert('Grades already submitted, cannot add subject.');

      const table = document.getElementById("gradeTable");
      const headerRow = table.rows[0];

      subjectCount++;

      // Add subject name header cell with input
      const subjectNameTh = document.createElement("th");
      const subjectInput = document.createElement("input");
      subjectInput.type = "text";
      subjectInput.placeholder = `Subject ${subjectCount}`;
      subjectInput.className = "subject-name";
      subjectInput.oninput = () => updateAllAverages(); // in case needed
      subjectNameTh.appendChild(subjectInput);
      // Insert before Average header (2nd last)
      headerRow.insertBefore(subjectNameTh, headerRow.cells[headerRow.cells.length - 2]);

      // Add empty header for grades - optional, we merge grade input under subject name
      // Instead of separate grade column, we use the same subject column for grades below header.

      // For each student row, add a grade input cell
      for (let i = 1; i < table.rows.length; i++) {
        const row = table.rows[i];
        const gradeTd = document.createElement("td");
        const gradeInput = document.createElement("input");
        gradeInput.type = "number";
        gradeInput.min = 60;
        gradeInput.max = 100;
        gradeInput.className = "grade-input";
        gradeInput.oninput = () => updateAverage(i);
        gradeTd.appendChild(gradeInput);
        // Insert before Average cell (2nd last)
        row.insertBefore(gradeTd, row.cells[row.cells.length - 2]);
      }

      updateAllAverages();
    }

    function addStudent() {
      if (gradesSubmitted) return alert('Grades already submitted, cannot add student.');
      studentCount++;
      const table = document.getElementById("gradeTable");
      const row = table.insertRow(-1);

      // Student name cell
      const nameCell = row.insertCell(0);
      const nameInput = document.createElement("input");
      nameInput.placeholder = `Student ${studentCount}`;
      nameCell.appendChild(nameInput);

      // Add grade input cells for each subject
      for (let i = 0; i < subjectCount; i++) {
        const gradeCell = row.insertCell(-1);
        const gradeInput = document.createElement("input");
        gradeInput.type = "number";
        gradeInput.min = 60;
        gradeInput.max = 100;
        gradeInput.className = "grade-input";
        gradeInput.oninput = () => updateAverage(table.rows.length - 1);
        gradeCell.appendChild(gradeInput);
      }

      // Average cell
      const avgCell = row.insertCell(-1);
      avgCell.className = "avg";
      avgCell.textContent = "-";

      // Rank cell
      const rankCell = row.insertCell(-1);
      rankCell.className = "rank";
      rankCell.textContent = "-";

      updateAllAverages();
    }

    function updateAverage(rowIndex) {
      const table = document.getElementById("gradeTable");
      const row = table.rows[rowIndex];
      let total = 0;
      let count = 0;

      for (let i = 1; i <= subjectCount; i++) {
        const input = row.cells[i].querySelector("input");
        const val = parseFloat(input.value);
        if (!isNaN(val)) {
          total += val;
          count++;
        }
      }

      const avgCell = row.cells[row.cells.length - 2];
      if (count === 0) {
        avgCell.textContent = "-";
        avgCell.classList.remove("red", "blue");
      } else {
        const avg = total / count;
        avgCell.textContent = avg.toFixed(2);
        if (avg < 70) {
          avgCell.classList.add("red");
          avgCell.classList.remove("blue");
        } else {
          avgCell.classList.add("blue");
          avgCell.classList.remove("red");
        }
      }

      updateRanks();
    }

    function updateAllAverages() {
      const table = document.getElementById("gradeTable");
      for (let i = 1; i < table.rows.length; i++) {
        updateAverage(i);
      }
    }

    function updateRanks() {
      const table = document.getElementById("gradeTable");
      let averages = [];
      for (let i = 1; i < table.rows.length; i++) {
        const avgText = table.rows[i].cells[table.rows[i].cells.length - 2].textContent;
        const avg = parseFloat(avgText);
        if (!isNaN(avg)) {
          averages.push({ index: i, avg: avg });
        }
      }
      averages.sort((a, b) => b.avg - a.avg);
      averages.forEach((entry, rank) => {
        const rankCell = table.rows[entry.index].cells[table.rows[entry.index].cells.length - 1];
        rankCell.textContent = rank + 1;
      });
    }

    function saveDraft() {
      alert("Draft saved locally (simulate).");
      // You can add localStorage saving here
    }

    function submitGrades() {
      if (gradesSubmitted) return alert("Grades already submitted.");
      // Lock inputs, save data etc - code here as before
      alert("Grades submitted (simulate). Inputs locked.");
      gradesSubmitted = true;

      // Disable all inputs
      const table = document.getElementById("gradeTable");
      for (let i = 1; i < table.rows.length; i++) {
        for (let j = 0; j < table.rows[i].cells.length; j++) {
          const input = table.rows[i].cells[j].querySelector("input");
          if(input) input.disabled = true;
        }
      }
      // Disable header subject name inputs too
      const headerRow = table.rows[0];
      for(let i =1; i <= subjectCount; i++) {
        const input = headerRow.cells[i].querySelector("input");
        if(input) input.disabled = true;
      }
    }

    function confirmLogout() {
      if (confirm("Are you sure you want to logout?")) {
        window.location.href = "index.html";
      }
    }
  </script>
</body>
</html>
