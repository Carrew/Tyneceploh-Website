<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Teacher Portal - Tyneceploh Educational Foundation</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #fff0f6;
    color: #4d0039;
    margin: 0; padding: 0;
  }
  header {
    background-color: #b35979;
    color: white;
    padding: 20px;
    text-align: center;
    font-size: 1.8rem;
    font-weight: bold;
  }
  #loginSection, #portalSection {
    max-width: 900px;
    margin: 20px auto;
    padding: 20px;
    background: #ffe6f0;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(179, 89, 121, 0.3);
  }
  #loginSection input, #loginSection button {
    padding: 10px;
    margin: 8px 0;
    width: 100%;
    max-width: 300px;
    font-size: 1rem;
    border: 2px solid #b35979;
    border-radius: 5px;
  }
  #loginSection button {
    background-color: #b35979;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #loginSection button:hover {
    background-color: #8b3c5d;
  }
  .error {
    color: red;
    margin-top: 8px;
  }
  .welcomeMsg {
    font-size: 1.2rem;
    margin-bottom: 20px;
    font-style: italic;
    color: #662244;
  }
  .flex-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 15px;
  }
  button {
    padding: 8px 14px;
    border-radius: 6px;
    border: 2px solid #b35979;
    background-color: #b35979;
    color: white;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #8b3c5d;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 30px;
  }
  th, td {
    border: 1px solid #b35979;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #f7c6d3;
    color: #4d0039;
  }
  input.gradeInput {
    width: 60px;
    text-align: center;
    border: 1.5px solid #b35979;
    border-radius: 4px;
    font-weight: 600;
  }
  input.gradeInput.red {
    background-color: #ffcccc;
    color: #a30000;
  }
  input.gradeInput.blue {
    background-color: #cce5ff;
    color: #003366;
  }
  .subject-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }
  .subject-row input.subjectName {
    flex-grow: 1;
  }
  .subject-row button.remove-subject {
    background-color: #a30000;
    border-color: #a30000;
  }
  .subject-row button.remove-subject:hover {
    background-color: #6b0000;
  }
  .student-block {
    border: 2px solid #b35979;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 25px;
    background: #fff0f6;
  }
  .student-header {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .student-header button.remove-student {
    background-color: #a30000;
    border-color: #a30000;
    padding: 5px 10px;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
  }
  .student-header button.remove-student:hover {
    background-color: #6b0000;
  }
  #addStudentBtn, #addSubjectBtn {
    margin-bottom: 20px;
  }
  #submitGradesBtn {
    background-color: #4d0039;
    border-color: #4d0039;
    margin-top: 15px;
    font-size: 1.1rem;
    padding: 12px 25px;
  }
  #submitGradesBtn:hover {
    background-color: #7a005e;
  }
  #logoutBtn {
    background-color: #a30000;
    border-color: #a30000;
    margin-top: 30px;
    font-size: 1rem;
    padding: 10px 20px;
  }
  #logoutBtn:hover {
    background-color: #6b0000;
  }
  .disabled {
    pointer-events: none;
    opacity: 0.6;
  }
</style>
</head>
<body>

<header>Teacher Portal - Tyneceploh Educational Foundation</header>

<section id="loginSection">
  <h2>Login</h2>
  <input type="text" id="teacherName" placeholder="Enter your full name" autocomplete="off" />
  <input type="text" id="teacherClass" placeholder="Enter your class (e.g. Grade 5A)" autocomplete="off" />
  <input type="password" id="teacherPassword" placeholder="Password" autocomplete="off" />
  <button id="loginBtn">Log In</button>
  <p class="error" id="loginError"></p>
</section>

<section id="portalSection" style="display:none;">
  <p class="welcomeMsg" id="welcomeMsg"></p>

  <button id="addStudentBtn">Add Student</button>

  <div id="studentsContainer"></div>

  <button id="submitGradesBtn">Submit Grades to Principal</button>

  <button id="logoutBtn">Logout</button>
</section>

<script>
  // Mock teacher credentials (in real app, this is from backend)
  const validTeachers = [
    { name: "John", class: "Grade 5", password: "pass" },
    { name: "Mr. Doe", class: "Grade 5A", password: "pass123" },
    { name: "Jane Smith", class: "Grade 4B", password: "abc123" }
  ];

  // Store login state
  let loggedInTeacher = null;
  let studentsData = []; // each student: {id, name, grades: {subject: score}, average, submitted}

  // Utility: Generate unique ID for students
  function generateId() {
    return '_' + Math.random().toString(36).substr(2, 9);
  }

  // Login handler
  document.getElementById('loginBtn').addEventListener('click', () => {
    const name = document.getElementById('teacherName').value.trim();
    const cls = document.getElementById('teacherClass').value.trim();
    const pass = document.getElementById('teacherPassword').value.trim();

    const teacher = validTeachers.find(t => 
      t.name.toLowerCase() === name.toLowerCase() &&
      t.class.toLowerCase() === cls.toLowerCase() &&
      t.password === pass
    );

    if (teacher) {
      loggedInTeacher = teacher;
      loginSuccess();
    } else {
      document.getElementById('loginError').textContent = "Invalid login information.";
    }
  });

  function loginSuccess() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('portalSection').style.display = 'block';
    document.getElementById('loginError').textContent = '';
    document.getElementById('welcomeMsg').textContent = `Welcome ${loggedInTeacher.name}! You are managing ${loggedInTeacher.class}.`;
    studentsData = [];
    renderStudents();
  }

  // Logout with confirmation
  document.getElementById('logoutBtn').addEventListener('click', () => {
    if (confirm("Are you sure you want to logout? Unsaved data will be lost.")) {
      loggedInTeacher = null;
      studentsData = [];
      document.getElementById('portalSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'block';
      clearLoginFields();
      clearStudentsContainer();
    }
  });

  function clearLoginFields() {
    document.getElementById('teacherName').value = '';
    document.getElementById('teacherClass').value = '';
    document.getElementById('teacherPassword').value = '';
    document.getElementById('loginError').textContent = '';
  }

  // Add Student button
  document.getElementById('addStudentBtn').addEventListener('click', () => {
    const studentName = prompt("Enter student full name:");
    if (studentName && studentName.trim() !== '') {
      const newStudent = {
        id: generateId(),
        name: studentName.trim(),
        grades: {}, // {subject: score}
        average: 0,
        submitted: false
      };
      studentsData.push(newStudent);
      renderStudents();
    }
  });

  // Render all students
  function renderStudents() {
    const container = document.getElementById('studentsContainer');
    container.innerHTML = '';
    if(studentsData.length === 0){
      container.innerHTML = '<p>No students added yet. Use "Add Student" button.</p>';
      return;
    }
    // Sort students by average descending for ranking
    studentsData.sort((a, b) => b.average - a.average);

    studentsData.forEach((student, index) => {
      const studentDiv = document.createElement('div');
      studentDiv.className = 'student-block';
      if(student.submitted) studentDiv.classList.add('disabled');

      // Header with student name & remove button
      const headerDiv = document.createElement('div');
      headerDiv.className = 'student-header';
      headerDiv.innerHTML = `
        <span><strong>${index+1}. ${student.name}</strong> (Rank)</span>
        ${student.submitted ? '' : `<button class="remove-student" data-id="${student.id}">Remove Student</button>`}
      `;
      studentDiv.appendChild(headerDiv);

      // Subjects and grades table
      const table = document.createElement('table');
      table.innerHTML = `
        <thead>
          <tr>
            <th>Subject</th>
            <th>Grade (60 - 100)</th>
          </tr>
        </thead>
        <tbody class="subjects-body"></tbody>
        <tfoot>
          <tr>
            <td><strong>Average</strong></td>
            <td id="avg-${student.id}">${student.average.toFixed(2)}</td>
          </tr>
        </tfoot>
      `;
      studentDiv.appendChild(table);

      // Container for subjects input rows
      const tbody = table.querySelector('.subjects-body');

      // Render each subject row
      for(let subject in student.grades) {
        const tr = createSubjectRow(student.id, subject, student.grades[subject], student.submitted);
        tbody.appendChild(tr);
      }

      // Add Subject button per student
      if(!student.submitted){
        const addSubjBtn = document.createElement('button');
        addSubjBtn.textContent = 'Add Subject';
        addSubjBtn.style.marginTop = '10px';
        addSubjBtn.addEventListener('click', () => {
          addSubject(student.id);
        });
        studentDiv.appendChild(addSubjBtn);
      }

      container.appendChild(studentDiv);
    });

    // Attach remove student event listeners
    document.querySelectorAll('.remove-student').forEach(btn => {
      btn.onclick = () => {
        const id = btn.getAttribute('data-id');
        studentsData = studentsData.filter(s => s.id !== id);
        renderStudents();
      };
    });
  }

  // Create a subject row
  function createSubjectRow(studentId, subjectName, gradeValue, disabled) {
    const tr = document.createElement('tr');

    const tdSubject = document.createElement('td');
    tdSubject.textContent = subjectName;
    tr.appendChild(tdSubject);

    const tdGrade = document.createElement('td');
    const inputGrade = document.createElement('input');
    inputGrade.type = 'number';
    inputGrade.min = 60;
    inputGrade.max = 100;
    inputGrade.value = gradeValue;
    inputGrade.className = 'gradeInput';
    inputGrade.disabled = disabled;
    inputGrade.addEventListener('input', (e) => {
      let val = Number(e.target.value);
      if (val < 60) val = 60;
      if (val > 100) val = 100;
      e.target.value = val;
      updateGrade(studentId, subjectName, val);
    });
    updateGradeColor(inputGrade, gradeValue);

    tdGrade.appendChild(inputGrade);
    tr.appendChild(tdGrade);

    return tr;
  }

  // Add subject for a student
  function addSubject(studentId) {
    const subjectName = prompt("Enter subject name:");
    if (!subjectName || subjectName.trim() === '') return alert("Subject name cannot be empty.");

    // Check if subject already exists for that student
    const student = studentsData.find(s => s.id === studentId);
    if(student.grades.hasOwnProperty(subjectName.trim())){
      return alert("Subject already added for this student.");
    }

    student.grades[subjectName.trim()] = 60; // default minimum grade
    updateStudentAverage(student);
    renderStudents();
  }

  // Update grade for a student's subject
  function updateGrade(studentId, subject, grade) {
    const student = studentsData.find(s => s.id === studentId);
    if (!student) return;
    student.grades[subject] = grade;
    updateStudentAverage(student);
    renderStudents();
  }

  // Update average grade of a student
  function updateStudentAverage(student) {
    const grades = Object.values(student.grades);
    if(grades.length === 0){
      student.average = 0;
      return;
    }
    const sum = grades.reduce((a,b) => a + Number(b), 0);
    student.average = sum / grades.length;
  }

  // Update color of grade input (red < 70, blue >= 70)
  function updateGradeColor(inputElement, grade) {
    if(grade < 70){
      inputElement.classList.add('red');
      inputElement.classList.remove('blue');
    } else {
      inputElement.classList.add('blue');
      inputElement.classList.remove('red');
    }
  }

  // Submit grades to principal (simulation)
  document.getElementById('submitGradesBtn').addEventListener('click', () => {
    if(studentsData.length === 0){
      return alert("No students to submit.");
    }
    // Check if all students have at least one subject and grades
    for(let student of studentsData){
      if(Object.keys(student.grades).length === 0){
        return alert(`Student ${student.name} has no subjects/grades entered.`);
      }
    }

    if(confirm("Are you sure you want to submit all grades to the principal? You won't be able to edit after submission.")){
      // Mark all students as submitted
      studentsData.forEach(s => s.submitted = true);
      renderStudents();
      alert("Grades submitted to principal successfully!");
    }
  });
</script>

</body>
</html>
